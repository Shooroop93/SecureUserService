# SecureUserService

**SecureUserService** ‚Äî —ç—Ç–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, –∏—Ö –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –∏ –≤—ã–¥–∞—á–µ–π JWT-—Ç–æ–∫–µ–Ω–æ–≤. –°–µ—Ä–≤–∏—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Java, Spring Boot –∏ gRPC, —Å —É–ø–æ—Ä–æ–º –Ω–∞ —á–∏—Å—Ç—É—é –∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É.

## üöÄ –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (email/login + password).
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ email (—Å—Å—ã–ª–∫–æ–π).
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è JWT-—Ç–æ–∫–µ–Ω–æ–≤.
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (USER, ADMIN).
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π –≤ Redis.
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ PostgreSQL.
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Liquibase –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π.
- gRPC API –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è.

---

## ‚öôÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 1. **gRPC API**
- `AuthService` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –≤—Ö–æ–¥, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞.

### 2. **REST API**
- `/api/user/confirm/{uuid}` ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### 3. **–°–µ—Ä–≤–∏—Å—ã**
- `UsersService` ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
- `RegistrationConfirmationService` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Å—ã–ª–æ–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.
- `RedisService` ‚Äî –æ–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ Redis.
- `TokenService` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ JWT-—Ç–æ–∫–µ–Ω–∞–º–∏ (–≤ –±—É–¥—É—â–µ–º).
- `RoleService` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏ (–≤ –±—É–¥—É—â–µ–º).

### 4. **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏**
- `UsersRepository` ‚Äî —Ä–∞–±–æ—Ç–∞ —Å —Ç–∞–±–ª–∏—Ü–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ PostgreSQL.

### 5. **–ú–æ–¥–µ–ª–∏ (Entities)**
- `Users` ‚Äî —Å—É—â–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ñ–ª–∞–≥–æ–º `isVerified`.

### 6. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
- Spring Security (–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ).
- JWT (–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ).
- –ü–∞—Ä–æ–ª–∏ —Ö–µ—à–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `BCrypt`.
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `require-verification` —á–µ—Ä–µ–∑ `application.yaml`.

### 7. **–ú–∏–≥—Ä–∞—Ü–∏–∏**
- Liquibase + —Å—Ç—Ä—É–∫—Ç—É—Ä—ã `changelog/changeset/v1/...`.
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —Ç–∞–±–ª–∏—Ü–∞–º –∏ –ø–æ–ª—è–º.

### 8. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `logging.level`, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ `UsersListener`.

---

## üìÑ gRPC API-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

- `Register` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Å—Å—ã–ª–∫–∏ –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ `require-verification`.
- `Login` ‚Äî (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ).
- `RefreshToken` ‚Äî (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ).

---

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç

- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: PostgreSQL + Liquibase + –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —Å—Ö–µ–º–∞–º.
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ —Å—Å—ã–ª–∫—É (Redis + UUID).
- ‚úÖ –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã: `RedisService`, `UsersService`, `RegistrationConfirmationService`.
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è —á–µ—Ä–µ–∑ `application.yaml`.
- ‚úÖ gRPC API: —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ `Register`.

---

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- **Java 21**
- **Spring Boot 3.x**
- **gRPC**
- **Redis**
- **PostgreSQL**
- **Liquibase**
- **Docker** (–≤ –±—É–¥—É—â–µ–º –¥–ª—è –¥–µ–ø–ª–æ—è)

---

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å–∫ PostgreSQL –∏ Redis
```bash
docker-compose up -d
```

### 2. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
./mvnw spring-boot:run
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ gRPC API
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å gRPC-–∫–ª–∏–µ–Ω—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, BloomRPC, Insomnia, Postman).

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
```http
GET http://localhost:8080/api/user/confirm/{uuid}
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ü–∞—Ä–æ–ª–∏: `BCrypt`.
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: Redis-—Å—Å—ã–ª–∫–∞ TTL.
- –í—Å–µ —Ç–æ–∫–µ–Ω—ã –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è (–≤ —Å–ª–µ–¥—É—é—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö).

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `application.yaml`
```yaml
spring:
  datasource:
    url: url
    username: username
    password: password
  data:
    redis:
      host: localhost
      port: 6379
      password: redispass
  user:
    registration:
      require-verification: true
    confirmation-link:
      retention-time: 1440
  liquibase:
    change-log: classpath:/db/changelog/changelog-master.yaml

grpc:
  server:
    port: 9090

security:
  bcrypt:
    strength: 10
```

---